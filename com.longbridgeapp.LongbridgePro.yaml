app-id: com.longbridgeapp.LongbridgePro
runtime: org.gnome.Platform
runtime-version: "48"
sdk: org.gnome.Sdk
separate-locales: false
command: longbridge

finish-args:
  - --device=dri
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=fallback-x11
  - --socket=wayland
  - --env=FONTCONFIG_FILE=/app/share/fonts/fonts.conf

modules:
  - name: longbridge
    buildsystem: simple
    build-commands:
      - install -D longbridgepro.sh /app/bin/longbridge
      - install -Dm644 longbridgepro.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/com.longbridgeapp.LongbridgePro.png
      - install -Dm644 com.longbridgeapp.LongbridgePro.metainfo.xml -t /app/share/metainfo
      - install -Dm644 fonts.conf -t /app/share/fonts/
      - install -Dm644 com.longbridgeapp.LongbridgePro.desktop -t /app/share/applications
      - install -D apply_extra -t /app/bin
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - bsdtar -xf longbridgepro.deb 'data.tar.zst'
          - bsdtar -xf data.tar.zst
          - mv usr/local/bin/longbridge longbridge
          - rm -r longbridgepro.deb usr data.tar.zst
      - type: file
        path: com.longbridgeapp.LongbridgePro.desktop
      - type: file
        path: com.longbridgeapp.LongbridgePro.metainfo.xml
      - type: file
        path: longbridgepro.sh
      - type: file
        path: longbridgepro.png
      - type: file
        path: fonts.conf
      - type: extra-data
        filename: longbridgepro.deb
        only-arches: [x86_64]
        url: https://assets.lbkrs.com/github/release/longbridge-desktop/stable/longbridge-v0.2.3-linux-x86_64.deb
        sha256: 6bcef91bfc8ee5e05539239c8c52cc147ca0ff59f53c12996860936e3447f737
        size: 34228596
        x-checker-data:
          type: json
          url: https://assets.lbkrs.com/github/release/longbridge-desktop/stable/latest.json
          version-query: .version
          url-query: .assets[] | select(.name | test("linux-x86_64\\.deb$")).url
